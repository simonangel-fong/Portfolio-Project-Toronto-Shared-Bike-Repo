pipeline {
  agent any

  stages {

    stage('Cleanup Workspace & Checkout') {
      steps {
          echo "#################### Checkout ####################"
          checkout scm // Explicitly checks out the SCM after cleaning.
          
          echo "#################### Cleans the workspace ####################"
          sh '''
            ls
            pwd
          '''
      }
    }

    stage('Download CSV Files') {
      steps {
        echo "#################### Download CSV zip ####################"
        sh '''
          rm -rf data-warehouse/postgresql/data
          mkdir -pv data-warehouse/postgresql/data
          ls -dl data-warehouse/postgresql/data

          curl -o data-warehouse/postgresql/csv.zip https://toronto-shared-bike-data-warehouse-data-bucket.s3.ca-central-1.amazonaws.com/raw/data.zip
          ls -l data-warehouse/postgresql/csv.zip
        '''
          
        echo "#################### Unzip CSV zip ####################"
        sh '''
          unzip -o data-warehouse/postgresql/csv.zip -d data-warehouse/postgresql
          ls -l data-warehouse/postgresql/data
          du -h data-warehouse/postgresql/data

          rm -fv data-warehouse/postgresql/csv.zip
        '''
      }
    }
  }
}
 