pipeline {
  agent any
    parameters {
    string(name: 'URL1', defaultValue: 'https://example.com/path/to/data.csv')
    string(name: 'CONTAINER_NAME', defaultValue: 'postgresql')
    string(name: 'DIR_RAW_DIR', defaultValue: 'raw')
    string(name: 'SCRIPT_LOCAL', defaultValue: 'etl.sh', description: 'Path to etl.sh in the repo/workspace')
    string(name: 'SCRIPT_IN_CONTAINER', defaultValue: '/tmp/etl.sh', description: 'Location to place etl.sh inside the container')
    }
  stages
  {
    stage('Start PostgreSQL') {
      steps {
        sh '''
        docker --version
        docker compose -f data-warehouse/postgresql/docker-compose.yaml up -d
        '''
      }
    }
    stage('Download Raw Data') {
      steps {
        sh '''
        echo download
        curl https://toronto-shared-bike-data-warehouse-data-bucket.s3.ca-central-1.amazonaws.com/raw/Ridership-2019-Q1.csv
        ls data-warehouse/postgresql/raw
        ls data-warehouse/postgresql/mv
        '''
      }
    }
    stage('Extract Data') {
      steps {
        sh 'echo Extract'
      }
    }
    stage('Transform Data') {
      steps {
        sh '''
        echo Transform
        '''
      }
    }
    stage('Load Data') {
      steps {
        sh 'echo Load'
      }
    }
    stage('Refresh MV') {
      steps {
        sh 'echo Refresh'
      }
    }
    stage('Export Data') {
      steps {
        sh 'echo Export'
      }
    }
    stage('Upload Data') {
      steps {
        sh 'echo Upload'
      }
    }
    stage('Stop PostgreSQL') {
      steps {
        sh 'docker compose -f data-warehouse/postgresql/docker-compose.yaml down'
      }
    }
  }
}
