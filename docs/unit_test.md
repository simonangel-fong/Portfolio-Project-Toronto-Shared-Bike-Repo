- Testing cases: `/bike`
  - B: `/bike` path
  - H: Happy path
  - E: exception

| ID       | Case_Name                              | Req_Path | Req_Method            | Req_Param             | Res_status        | Res_header        | Res_body                               |
| -------- | -------------------------------------- | -------- | --------------------- | --------------------- | ----------------- | ----------------- | -------------------------------------- |
| **BH00** | Bike CORS preflight                    | /bike    | OPTIONS               | —                     | 204               | CORS `*` (+Allow) | `""`                                   |
| **BH01** | Bike baseline (all items)              | /bike    | GET                   | —                     | 200               | CORS `*`          | JSON `{datetime,count,data}`           |
| **BH02** | Bike empty table                       | /bike    | GET                   | —                     | 200               | CORS `*`          | JSON with empty `data`                 |
| **BH03** | Bike filtered by year (exists)         | /bike    | GET                   | `year=2019`           | 200               | CORS `*`          | JSON `{datetime,count,data}`           |
| **BH04** | Bike filtered by year (nonexistent)    | /bike    | GET                   | `year=2000`           | 200               | CORS `*`          | JSON with empty `data`                 |
| **BH05** | Bike non-numeric year (tolerant=empty) | /bike    | GET                   | `year=abcd`           | 200               | CORS `*`          | JSON with empty `data`                 |
| **BH06** | Bike year with whitespace handled      | /bike    | GET                   | `year=" 2019 "`       | 200               | CORS `*`          | JSON filtered as for 2019              |
| **BH07** | Bike success response contract         | /bike    | GET                   | any of above 200s     | 200               | CORS `*`          | `datetime` ISO8601Z; `count=len(data)` |
| **BE01** | Bike DynamoDB exception                | /bike    | GET                   | —                     | 500               | CORS `*`          | JSON `{"error": ...}`                  |
| **BE02** | Bike unsupported methods               | /bike    | POST/PUT/DELETE/PATCH | —                     | 404               | CORS `*`          | JSON `{"error":"Not Found"}`           |
| **BE03** | Bike unknown query param policy        | /bike    | GET                   | `foo=bar`             | 200 (or 400)\*    | CORS `*`          | JSON normal (or error)\*               |
| **BE04** | Bike multi-value param policy          | /bike    | GET                   | `year=2019&year=2020` | 400 (recommended) | CORS `*`          | JSON `{"error": ...}`                  |

| ID  | Scenario           | Method    | Path             | Query params | DynamoDB mock/setup | Expected status | Key header checks                                              | Body assertions (high-level) | Notes                                          |
| --- | ------------------ | --------- | ---------------- | ------------ | ------------------- | --------------- | -------------------------------------------------------------- | ---------------------------- | ---------------------------------------------- |
| R01 | Preflight CORS     | `OPTIONS` | `/bike`          | —            | —                   | `204`           | `Access-Control-Allow-Origin:*`, Methods include `GET,OPTIONS` | Empty body                   | Covers CORS preflight.                         |
| R02 | Unknown path       | `GET`     | `/mv_bike_count` | —            | —                   | `404`           | (none in code)                                                 | `"Not Found"`                | Reveals missing CORS on 404 (consider adding). |
| R03 | Unsupported method | `POST`    | `/bike`          | —            | —                   | `404`           | (none)                                                         | `"Not Found"`                | Method gate works as intended.                 |

| ID  | Scenario                    | Method | Path    | Query params | DynamoDB mock/setup                                  | Expected status | Key header checks | Body assertions                                                         | Notes                                            |
| --- | --------------------------- | ------ | ------- | ------------ | ---------------------------------------------------- | --------------- | ----------------- | ----------------------------------------------------------------------- | ------------------------------------------------ |
| B01 | `/bike` no params           | `GET`  | `/bike` | —            | `scan()` → `[{"dim_year":"2020","bike_count":"15"}]` | `200`           | CORS `*`          | `datetime` ISO8601Z; `count=1`; `data[0]={dim_year:2020,bike_count:15}` | Basic happy path & int casting.                  |
| B02 | `/bike` with `year`         | `GET`  | `/bike` | `year=2020`  | `scan` with `Attr('dim_year').eq('2020')` → 1 row    | `200`           | CORS              | `count=1` and filtered                                                  | Verify filter expression used.                   |
| B03 | `/bike` invalid `year` type | `GET`  | `/bike` | `year=abcd`  | `scan` (still filters as string) → `[]`              | `200`           | CORS              | `count=0`                                                               | Filter compares to `'abcd'`; fine.               |
| B04 | `/bike` bad item types      | `GET`  | `/bike` | —            | `scan()` → `[{"dim_year":"NaN","bike_count":null}]`  | `500`           | CORS              | `{"error": "...ValueError..."}`                                         | `int()` cast should raise—good robustness check. |
| B05 | `/bike` empty table         | `GET`  | `/bike` | —            | `scan()` → `[]`                                      | `200`           | CORS              | `count=0`, `data=[]`                                                    | Graceful empty response.                         |

| ID  | Scenario                  | Method | Path       | Query params | DynamoDB mock/setup                                      | Expected status | Key header checks | Body assertions                | Notes                   |
| --- | ------------------------- | ------ | ---------- | ------------ | -------------------------------------------------------- | --------------- | ----------------- | ------------------------------ | ----------------------- |
| S01 | `/station` no params      | `GET`  | `/station` | —            | `scan()` → `[{"dim_year":"2021","station_count":"320"}]` | `200`           | CORS              | `count=1`; `station_count` int | Mirrors bike logic.     |
| S02 | `/station` with `year`    | `GET`  | `/station` | `year=2021`  | Filtered `scan` → row                                    | `200`           | CORS              | Filter applied; `count=1`      |                         |
| S03 | `/station` missing fields | `GET`  | `/station` | —            | Row missing `station_count`                              | `500`           | CORS              | Error JSON present             | `int(None)` error path. |

| ID  | Scenario                        | Method | Path         | Query params            | DynamoDB mock/setup                                  | Expected status | Key header checks | Body assertions                                                                                   | Notes                                   |
| --- | ------------------------------- | ------ | ------------ | ----------------------- | ---------------------------------------------------- | --------------- | ----------------- | ------------------------------------------------------------------------------------------------- | --------------------------------------- |
| H01 | `/trip-hour` no params          | `GET`  | `/trip-hour` | —                       | `scan()` → 2 mixed rows (strings)                    | `200`           | CORS              | required keys: `dim_year`,`dim_hour`,`dim_user`,`trip_count`,`duration_sum` (ints where expected) | Baseline schema.                        |
| H02 | `/trip-hour` year only          | `GET`  | `/trip-hour` | `year=2021`             | filter on `dim_year='2021'`                          | `200`           | CORS              | all rows have `dim_year=2021`                                                                     |                                         |
| H03 | `/trip-hour` user only          | `GET`  | `/trip-hour` | `user=Member`           | filter on `dim_user='Member'`                        | `200`           | CORS              | all rows `dim_user='Member'`                                                                      |                                         |
| H04 | `/trip-hour` year+user          | `GET`  | `/trip-hour` | `year=2021&user=Casual` | combined filter `&`                                  | `200`           | CORS              | rows match both                                                                                   | Composed filter works.                  |
| H05 | `/trip-hour` bad numeric fields | `GET`  | `/trip-hour` | —                       | row has `"trip_count":"x"` or missing `duration_sum` | `500`           | CORS              | error JSON                                                                                        | Casting robustness.                     |
| H06 | `/trip-hour` zero values        | `GET`  | `/trip-hour` | —                       | row with zeros                                       | `200`           | CORS              | ints equal 0 retained                                                                             | No divide-by-zero here but check shape. |

| ID  | Scenario                   | Method | Path          | Query params            | DynamoDB mock/setup       | Expected status | Key header checks | Body assertions                            | Notes                                         |
| --- | -------------------------- | ------ | ------------- | ----------------------- | ------------------------- | --------------- | ----------------- | ------------------------------------------ | --------------------------------------------- |
| M01 | `/trip-month` no params    | `GET`  | `/trip-month` | —                       | 1 row                     | `200`           | CORS              | keys inc. `dim_month` int                  | Baseline.                                     |
| M02 | `/trip-month` year only    | `GET`  | `/trip-month` | `year=2022`             | filtered rows             | `200`           | CORS              | `dim_year=2022`                            |                                               |
| M03 | `/trip-month` user only    | `GET`  | `/trip-month` | `user=Member`           | filtered rows             | `200`           | CORS              | `dim_user=Member`                          |                                               |
| M04 | `/trip-month` both filters | `GET`  | `/trip-month` | `year=2022&user=Casual` | both match                | `200`           | CORS              | both constraints satisfied                 |                                               |
| M05 | `/trip-month` bad month    | `GET`  | `/trip-month` | —                       | row with `dim_month:"13"` | `200`           | CORS              | int cast OK; (content validation deferred) | Content validity could be phase 2 rule check. |

| ID  | Scenario                            | Method | Path           | Query params            | DynamoDB mock/setup   | Expected status  | Key header checks | Body assertions          | Notes                                                                                         |
| --- | ----------------------------------- | ------ | -------------- | ----------------------- | --------------------- | ---------------- | ----------------- | ------------------------ | --------------------------------------------------------------------------------------------- |
| T01 | `/top-station` no params            | `GET`  | `/top-station` | —                       | 2 rows                | `200`            | CORS              | keys inc. `dim_station`  | Baseline.                                                                                     |
| T02 | `/top-station` year only            | `GET`  | `/top-station` | `year=2021`             | filtered rows         | `200`            | CORS              | filtered by year         |                                                                                               |
| T03 | `/top-station` user filter intended | `GET`  | `/top-station` | `user=Member`           | Expect filter by user | **BUG EXPECTED** | CORS              | **Not filtered by user** | Handler calls `_top_station(year)` and drops `user`. This test should FAIL, exposing the bug. |
| T04 | `/top-station` year+user            | `GET`  | `/top-station` | `year=2021&user=Member` | Expect both filters   | **BUG EXPECTED** | CORS              | **User filter ignored**  | Same bug.                                                                                     |

| ID  | Scenario                                    | Method             | Path              | Query params                                                           | DynamoDB mock/setup | Expected status | Key header checks                       | Body assertions                              | Notes                       |
| --- | ------------------------------------------- | ------------------ | ----------------- | ---------------------------------------------------------------------- | ------------------- | --------------- | --------------------------------------- | -------------------------------------------- | --------------------------- |
| E01 | DynamoDB exception                          | any matching route | —                 | Force `table.scan()` to raise `ProvisionedThroughputExceededException` | `500`               | CORS            | `{"error": "..."};` no stack trace leak | Error path & logging.                        |                             |
| E02 | Event shape: no `queryStringParameters` key | `GET`              | `/bike`           | —                                                                      | normal              | `200`           | CORS                                    | works (code guards with `params or None`)    | Event robustness.           |
| E03 | Event shape: `queryStringParameters=None`   | `GET`              | `/station`        | `None`                                                                 | normal              | `200`           | CORS                                    | works                                        |                             |
| E04 | Event missing `path`                        | `GET`              | —                 | —                                                                      | —                   | `404`           | (none)                                  | Not Found                                    | Defensive default behavior. |
| E05 | Response schema smoke check                 | `GET`              | each success path | —                                                                      | normal              | `200`           | CORS                                    | `datetime` ends with `Z`; `count==len(data)` | Output consistency.         |
